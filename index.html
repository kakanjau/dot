<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>DoT 模板</title>
        <link rel="stylesheet" href="bootstrap.min.css">
        <script src="dot.min.js"></script>
        <style>
            textarea {
                width: 100%;
                resize: vertical;
            }

            #result {
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <col-xs-12>
                    <h4>DoT基本语法：</h4>
                    <ul>
                        <li>{{ }} interpolation 代码片段</li>
                        <li>{{= }} evaluation 赋值</li>
                        <li>{{! }} encode 转移</li>
                        <li>{{? }} conditionals 条件</li>
                        <li>{{~ }} array iteration 循环</li>
                        <li>{{# }} compile-time evalution/includes and partials 编译时载入代码片段、文件</li>
                        <li>{{## #}} compile-time defines 编译时变量定义</li>
                    </ul>
                </col-xs-12>
            </div>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="col-xs-5">
                        <div>
                            <a class="btn btn-primary">运行</a>
                        </div>
                        <div class="text-right">html</div>
                        <textarea id="template" rows="10"></textarea>
                        <div class="text-right">编译时数据</div>
                        <textarea id="compileData" rows="6"></textarea>
                        <div class="text-right">运行时数据</div>
                        <textarea id="runtimeData" rows="6"></textarea>
                    </div>
                    <div class="col-xs-6">
                        <pre id="result"></pre>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var btn = document.querySelector('.btn');
            var textTemplate = document.querySelector('#template');
            var compileData = document.querySelector('#compileData');
            var runtimeData = document.querySelector('#runtimeData');
            var result = document.querySelector('#result');
            var config = doT.templateSettings = {
                evaluate:    /\{\{([\s\S]+?)\}\}/g,
                interpolate: /\{\{=([\s\S]+?)\}\}/g,
                encode:      /\{\{!([\s\S]+?)\}\}/g,
                use:         /\{\{#([\s\S]+?)\}\}/g,
                define:      /\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,
                conditional: /\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,
                iterate:     /\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,
                varname: 'it',
                strip: false,
                append: true,
                selfcontained: false
            };
            btn.onclick = textTemplate.oninput = compileData.oninput = runtimeData.oninput = 
            function() {
                try{
                    var cJsonData = compileData.value && eval('(' + compileData.value + ')')
                    var rJsonData = runtimeData.value && eval('(' + runtimeData.value + ')');
                    var doTCompiled = doT.template(textTemplate.value, config, cJsonData);

                    result.innerText = doTCompiled(rJsonData);
                }catch(ex) {
                    result.innerText = '输入有误，无法编译模板';
                }
            };
        </script>
    </body>
</html>